%% generating model
clc;clear;close all;
x = 0:0.01:1;
updown = betapdf(x,0.85,0.65);
leftright = betapdf(x,0.7,0.7);
gridv = updown'*leftright;

gridv = gridv + 0.01*randn(size(gridv));
gridv = gridv.^2.5;
[index(:,1) index(:,2)] = find(gridv);

%% random sampling
pd = makedist('Normal','mu',50,'sigma',40);

psub = round(random(pd,[2000 2]));
psub(psub(:,1)>101,:) = [];
psub(psub(:,1)<1,:) = [];
psub(psub(:,2)>101,:) = [];
psub(psub(:,2)<1,:) = [];

% permIndex = randperm(length(index));
% permIndex = permIndex(1:2000);


%% recover the model 
% psub = index(permIndex,:);
pindex = sub2ind(size(gridv),psub(:,1),psub(:,2));
pvalue = gridv(pindex);

[xq yq] = meshgrid(1:100,1:100);
vq = griddata(psub(:,1),psub(:,2),pvalue,xq,yq,'cubic');
%%
figureSize = [500 500 400 300 ];
axesPosition = [0.106666666666667 0.103333333333333 0.808333333333335 0.861666666666667];
colorbarPosition = [0.890172839506176 0.133333333333333 0.0268971193415638 0.811666666666667];

figure1 = figure('Colormap',[0.368627458810806 0.309803932905197 0.635294139385223;0.316435217857361 0.345023304224014 0.66557902097702;0.322406232357025 0.468231916427612 0.664803147315979;0.328377217054367 0.591440558433533 0.664027214050293;0.334348231554031 0.714649140834808 0.663251340389252;0.436488926410675 0.760174751281738 0.652343392372131;0.538629651069641 0.805700361728668 0.641435503959656;0.640770316123962 0.851225972175598 0.630527555942535;0.742910981178284 0.896751582622528 0.61961966753006;0.84505170583725 0.942277193069458 0.608711719512939;0.87498140335083 0.932118833065033 0.60066831111908;0.90491110086441 0.921960473060608 0.592624962329865;0.934840857982635 0.911802053451538 0.584581553936005;0.964770555496216 0.901643693447113 0.57653820514679;0.994700253009796 0.891485333442688 0.56849479675293;0.991530001163483 0.829831600189209 0.521850049495697;0.988359689712524 0.768177807331085 0.475205302238464;0.985189437866211 0.706524074077606 0.428560554981232;0.982019186019897 0.644870340824127 0.381915837526321;0.978848874568939 0.583216547966003 0.335271090269089;0.975678622722626 0.521562814712524 0.288626343011856;0.967397928237915 0.509524643421173 0.287933260202408;0.95911717414856 0.497486472129822 0.28724017739296;0.950836479663849 0.48544830083847 0.286547064781189;0.942555785179138 0.473410129547119 0.285853981971741;0.934275031089783 0.461371958255768 0.285160899162292;0.925994336605072 0.449333816766739 0.284467816352844;0.917713642120361 0.437295645475388 0.283774733543396;0.909432888031006 0.425257474184036 0.283081650733948;0.901152193546295 0.413219302892685 0.282388538122177;0.892871499061584 0.401181131601334 0.281695455312729;0.884590744972229 0.389142960309982 0.281002372503281;0.876310050487518 0.377104789018631 0.280309289693832;0.868029296398163 0.36506661772728 0.279616206884384;0.859748601913452 0.353028446435928 0.278923094272614;0.851467907428741 0.340990275144577 0.278230011463165;0.843187153339386 0.328952103853226 0.277536928653717;0.834906458854675 0.316913962364197 0.276843845844269;0.826625764369965 0.304875791072845 0.276150763034821;0.818345010280609 0.292837619781494 0.27545765042305;0.810064315795898 0.280799448490143 0.274764567613602;0.801783621311188 0.268761277198792 0.274071484804153;0.793502867221832 0.25672310590744 0.273378401994705;0.785222172737122 0.244684934616089 0.272685319185257;0.776941478252411 0.232646763324738 0.271992236375809;0.768660724163055 0.220608606934547 0.271299123764038;0.760380029678345 0.208570435643196 0.27060604095459;0.752099335193634 0.196532264351845 0.269912958145142;0.743818581104279 0.184494093060493 0.269219875335693;0.735537886619568 0.172455921769142 0.268526792526245;0.727257192134857 0.160417765378952 0.267833679914474;0.718976438045502 0.148379594087601 0.267140597105026;0.710695743560791 0.136341422796249 0.266447514295578;0.702414989471436 0.124303251504898 0.26575443148613;0.694134294986725 0.112265087664127 0.265061348676682;0.685853600502014 0.100226916372776 0.264368236064911;0.677572846412659 0.0881887450814247 0.263675153255463;0.669292151927948 0.076150581240654 0.262982070446014;0.661011457443237 0.0641124099493027 0.262288987636566;0.652730703353882 0.0520742423832417 0.261595904827118;0.644450008869171 0.0400360748171806 0.26090282201767;0.63616931438446 0.0279979053884745 0.260209709405899;0.627888560295105 0.0159597378224134 0.259516626596451;0.619607865810394 0.00392156885936856 0.258823543787003]);
set(figure1,'Position',figureSize);
set(figure1,'DefaultAxesFontSize',13);

axes1 = axes('Parent',figure1,'YTickLabel',{'-40','-20','0','20','40'},...
    'YTick',[10 30 50 70 90],...
    'XTickLabel',{'40','20','0','-20','-40'},...
    'XTick',[10 30 50 70 90],...
    'ZTickLabel',{'1','20','40'},...
    'ZTick',[0.286050329880405 4.28605032988041 8.28605032988041],...
    'Position',axesPosition,...
    'CLim',[min(min(vq))*0.8 max(max(vq))*0.9]);

xlim(axes1,[0 100]);
ylim(axes1,[0 100]);
zlim(axes1,[min(min(vq)) max(max(vq))]);
% grid(axes1,'on');
view(axes1,[-45 28]);
hold(axes1,'all');

s = surf(xq,yq,vq,'Parent',axes1,'FaceColor','interp',...
    'EdgeColor','none','LineStyle','none');
% alpha(s,0.9);

xlabel('Elevation Angle (\circ)');

% Create ylabel
ylabel('Azimuth Angle (\circ)');

zlabel('Tracking Error (Pixels)');

% Create colorbar
% colorbar('peer',axes1,colorbarPosition);

opengl('OpenGLLineSmoothingBug',1);
set(figure1,'Position',figureSize);
save2pdf('ASMFaceTrackingError.eps',gcf,'opengl');
path1 = getenv('PATH');
path1 = [path1 ':/usr/local/bin' ':/usr/texbin'];
setenv('PATH',path1);
system('epspdf ./ASMFaceTrackingError.eps ./ASMFaceTrackingError.pdf');