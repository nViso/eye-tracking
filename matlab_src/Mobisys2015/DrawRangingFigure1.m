
[lm lv] = ScanViewZLayer;
m2 = smooth3(lm);
v2 = smooth3(lv);

%%
figureSize = [500 500 400 330 ];
axesPosition = [0.133333333333333 0.123333333333333 0.84 0.85];
colorbarPosition = [0.890172839506176 0.133333333333333 0.0468971193415638 0.811666666666667];


m2 = smooth3(lm);
v2 = smooth3(lv);
close all;

figure1 = figure('Renderer','OpenGL',...
    'Colormap',[0.37058824300766 0.311764717102051 0.637254953384399;0.318396002054214 0.346984088420868 0.667539834976196;0.276103109121323 0.382302731275558 0.692940950393677;0.243333101272583 0.417720228433609 0.713317096233368;0.219709619879723 0.453236162662506 0.728527188301086;0.226060271263123 0.489214032888412 0.734274983406067;0.232483580708504 0.525151669979095 0.740022838115692;0.238979533314705 0.561036348342896 0.745770633220673;0.245548129081726 0.596855163574219 0.751518487930298;0.252189368009567 0.632595360279083 0.757266342639923;0.258903294801712 0.668244063854218 0.763014137744904;0.265689820051193 0.703788459300995 0.768761992454529;0.272549033164978 0.739215731620789 0.774509847164154;0.310063928365707 0.79790860414505 0.713011980056763;0.349302619695663 0.821307361125946 0.623839378356934;0.390265166759491 0.844706177711487 0.543549656867981;0.432951539754868 0.868104934692383 0.473406463861465;0.540050089359283 0.891503691673279 0.477361708879471;0.678377568721771 0.91490250825882 0.523495733737946;0.806215524673462 0.938301265239716 0.571353554725647;0.922300279140472 0.961700081825256 0.620935261249542;0.92472779750824 0.961139500141144 0.628584444522858;0.927053689956665 0.960578918457031 0.636224269866943;0.929278075695038 0.960018336772919 0.643854737281799;0.931401252746582 0.959457814693451 0.651475846767426;0.933423280715942 0.958897233009338 0.659087598323822;0.935344338417053 0.958336651325226 0.666689991950989;0.937164664268494 0.957776129245758 0.674283027648926;0.938884377479553 0.957215547561646 0.681866645812988;0.940503656864166 0.956654965877533 0.689440965652466;0.942022681236267 0.956094443798065 0.697005927562714;0.948398292064667 0.953414678573608 0.711462557315826;0.960530161857605 0.952512383460999 0.698387622833252;0.967645645141602 0.944499135017395 0.685039877891541;0.974761128425598 0.934349298477173 0.671419262886047;0.982061088085175 0.923785805702209 0.638332366943359;0.989361047744751 0.910172045230865 0.604677855968475;0.996661067008972 0.893446147441864 0.570455610752106;0.998034536838531 0.876907229423523 0.541777193546295;0.997873902320862 0.855181097984314 0.5147705078125;0.995625615119934 0.825547337532043 0.489423364400864;0.993377327919006 0.794078230857849 0.46418571472168;0.991129040718079 0.760787069797516 0.439057528972626;0.988880753517151 0.725687146186829 0.414038807153702;0.986632525920868 0.688791871070862 0.389129549264908;0.98438423871994 0.650114476680756 0.364329755306244;0.982135951519012 0.609668433666229 0.33963942527771;0.979887664318085 0.567467033863068 0.315058529376984;0.977639436721802 0.5235236287117 0.29058712720871;0.970360696315765 0.481826514005661 0.274281173944473;0.962252020835876 0.443440288305283 0.265550285577774;0.952736735343933 0.409744799137115 0.2659050822258;0.933084309101105 0.3686503469944 0.26672375202179;0.913431882858276 0.329628378152847 0.267277538776398;0.893779516220093 0.292634040117264 0.267566502094269;0.874127089977264 0.267590582370758 0.277558743953705;0.854474723339081 0.26734983921051 0.310150891542435;0.821202397346497 0.221299797296524 0.294265866279602;0.787930130958557 0.178148925304413 0.28203147649765;0.754657804965973 0.137897253036499 0.273023843765259;0.721385538578033 0.10054475069046 0.266819149255753;0.688113212585449 0.0660914406180382 0.262993544340134;0.65484094619751 0.0345373041927814 0.261123210191727;0.62156867980957 0.0058823530562222 0.260784327983856]);

set(figure1,'Position',figureSize);
% set(figure1,'Colormap',linspecer);
set(figure1,'DefaultAxesFontSize',13);
% Create axes
axes1 = axes('Parent',figure1,...
    'ZTickLabel',{'-0.3','-0.15','0','0.15','0.3'},...
    'ZTick',[1 11 21 31 40],...
   'YTickLabel',{'-0.3','-0.15','0','0.15','0.3'},...
    'YTick',[1 11 21 31 40],...
    'XTickLabel',{'-1.05','-0.9','-0.75','-0.6'},...
    'XTick',[10.5 20.5 30.5 40],...
    'Position',axesPosition,...
    'CLim',[0.2 0.7]);

xlim(axes1,[1 40.5]);
ylim(axes1,[1 40.5]);
zlim(axes1,[1 40.5]);
xlabel('Y (m)');
ylabel('X (m)');
zlabel('Z (m)');
hold(axes1,'all');
view(axes1,[150 35]);


isosurface(m2,0.3);
isosurface(m2,0.4);
isosurface(m2,0.75);
alpha(0.4);

s1 = sum(m2,1)/30;
s2 = sum(m2,2)/100;
s3 = sum(m2,3)/30;
m2(1,:,:) = s1;
m2(:,1,:) = s2;
m2(:,:,1) = s3;
s4 = slice(axes1,m2,[  1],[1 ],[1 ]);
set(s4,'FaceColor','interp',...
	'EdgeColor','none',...
	'DiffuseStrength',1000);
alpha(s4,'color');
t = text(41,25,21,' \leftarrow \epsilon>0.3','FontSize',14,'FontWeight','bold');
t = text(41,27,28,' \leftarrow \epsilon>0.2','FontSize',14,'FontWeight','bold');
t = text(41,25,33,' \leftarrow \epsilon>0.1','FontSize',14,'FontWeight','bold');

set(axes1,'CLim',[0.2 0.7]);

save2pdf('RangingErrorDistribution.pdf',figure1,'OpenGL');